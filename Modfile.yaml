modfileVersion: "v1"
id: github.com/SENERGY-Platform/mgw-zwave-dc-module
name: Mqtt Device-Connector
version: v0.0.1
type: device-connector
deploymentType: single
description: "after deployment, the zwave2mqtt service has to be manually configured: \n - "
# ref to mgw broker
# TODO: replace with real mgw broker
dependencies:
  github.com/SENERGY-Platform/mgw-test-module-a:
    version: <v3.0.0
    requiredServices:
      server:
        - refVar: MGW_MQTT_BROKER
          valuePrefix: "tcp://" #TODO: replace with https://tickets.infai.org/browse/SNRGY-2820 solution
          valueSuffix: ":1883" #TODO: replace with https://tickets.infai.org/browse/SNRGY-2820 solution
          services:
            - mgw-mqtt-dc
        #TODO: replace with https://tickets.infai.org/browse/SNRGY-2821 solution
        - refVar: ZWAVE_MQTT_BROKER
          valuePrefix: "tcp://" #TODO: replace with https://tickets.infai.org/browse/SNRGY-2820 solution
          valueSuffix: ":1883" #TODO: replace with https://tickets.infai.org/browse/SNRGY-2820 solution
          services:
            - mgw-mqtt-dc
hostResources:
  devices:
    userInput:
      name: Device
      description: "e.g.: /dev/serial/by-id/usb-0658_0200-if00"
    targets:
      - mountPoint: "/dev/zwave"
        services:
          - zwave2mqtt
services:
  zwave2mqtt:
    name: zwave2mqtt
    image: zwavejs/zwavejs2mqtt:latest
  mgw-zwave-dc:
    name: mgw-zwave-dc
    image: ghcr.io/senergy-platform/mgw-zwave-dc:v1.0.0
secrets:
  auth:
    type: basic-auth
    targets:
      - refVar: AUTH_USERNAME
        item: username
        services:
          - mgw-mqtt-dc
      - refVar: AUTH_PASSWORD
        item: password
        services:
          - mgw-mqtt-dc
configs:
## broker config by dependency
#  mqttBroker:
#    dataType: string
#    value: "tcp://message-broker:1883" #TODO: replace with https://tickets.infai.org/browse/SNRGY-2821 solution
#    targets:
#      - refVar: ZWAVE_MQTT_BROKER
#        services:
#          - mgw-zwave-dc
#    userInput:
#      type: text
#      name: MQTT Broker
#      description: "e.g. tcp://message-broker:1883"
#      group: mqtt
## credentials are empty
#  mqttUsername:
#    dataType: string
#    optional: true
#    targets:
#      - refVar: ZWAVE_MQTT_USER
#        services:
#          - mgw-zwave-dc
#    userInput:
#      type: text
#      name: MQTT Username
#      group: mqtt
#  mqttPassword:
#    dataType: string
#    optional: true
#    targets:
#      - refVar: ZWAVE_MQTT_PW
#        services:
#          - mgw-zwave-dc
#    userInput:
#      type: text
#      name: MQTT Password
#      group: mqtt
  mqttClientId:
    dataType: string
    value: "mgw-zwave-dc_zwave"
    targets:
      - refVar: ZWAVE_MQTT_CLIENT_ID
        services:
          - mgw-zwave-dc
    userInput:
      type: text
      name: MQTT ClientID CMD
      group: mqtt
## mgw broker config by dependency
#  mgwMqttBroker:
#    dataType: string
#    value: "tcp://message-broker:1883"
#    targets:
#      - refVar: MGW_MQTT_BROKER
#        services:
#          - mgw-zwave-dc
#    userInput:
#      type: text
#      name: MGW MQTT Broker
#      description: "e.g. tcp://message-broker:1883"
#      group: mqtt
## mgw credentials are empty
#  mgwMqttUsername:
#    dataType: string
#    targets:
#      - refVar: MGW_MQTT_USER
#        services:
#          - mgw-zwave-dc
#    userInput:
#      type: text
#      name: MGW MQTT Username
#      group: mgw
#  mgwMqttPassword:
#    dataType: string
#    targets:
#      - refVar: MGW_MQTT_PW
#        services:
#          - mgw-zwave-dc
#    userInput:
#      type: text
#      name: MGW MQTT Password
#      group: mgw
  mgwMqttClientId:
    dataType: string
    value: "mgw-zwave-dc_mgw"
    targets:
      - refVar: MGW_MQTT_CLIENT_ID
        services:
          - mgw-zwave-dc
  zwvaecontroller:
    dataType: string
    value: "zwavejs2mqtt"
    options:
      - "zwave2mqtt"
      - "zwavejs2mqtt"
    targets:
      - refVar: ZWAVE_CONTROLLER
        services:
          - mgw-zwave-dc
  authUrl:
    dataType: string
    value: "https://auth.senergy.infai.org"
    targets:
      - refVar: AUTH_ENDPOINT
        services:
          - mgw-zwave-dc
    userInput:
      type: text
      name: Auth URL
      group: platform
  permissionSearchUrl:
    dataType: string
    value: "https://api.senergy.infai.org/permissions/query"
    targets:
      - refVar: PERMISSIONS_SEARCH_URL
        services:
          - mgw-zwave-dc
    userInput:
      type: text
      name: Permission Search URL
      group: platform
  deviceManagerUrl:
    dataType: string
    value: "https://api.senergy.infai.org/device-manager"
    targets:
      - refVar: DEVICE_MANAGER_URL
        services:
          - mgw-zwave-dc
    userInput:
      type: text
      name: Device Manager URL
      group: platform
  debug:
    dataType: string
    value: "true"
    options:
      - "true"
      - "false"
    optionsExt: false
    targets:
      - refVar: DEBUG
        services:
          - mgw-mqtt-dc
    userInput:
      type: text
      name: DEBUG
inputGroups: 
  mqtt:
    name: "MQTT"
  mgw:
    name: "MGW"
  platform:
    name: "Platform"